<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Vaporwave Calculator</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background: black;
      color: white;
      font-family: monospace;
      overflow: hidden;
    }

    #bg-grid {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      z-index: -1;
      background: url('./background_gif.gif') center/cover no-repeat;
      opacity: 0.2;
      filter: blur(2px);
    }

    .input-bar {
      background-color: #2d2d2d;
      border-radius: 9999px;
      padding: 0.75rem 1rem;
      color: white;
      width: 100%;
    }

    .input-bar::placeholder {
      color: #888;
    }

    canvas {
      border-radius: 1rem;
    }

    .audio-bar {
      position: fixed;
      bottom: 1rem;
      right: 1rem;
      width: 10%;
      background-color: rgba(0, 0, 0, 0.8);
      padding: 0.5rem;
      border-radius: 1rem;
      display: flex;
      align-items: center;
      justify-content: space-around;
      font-size: 0.75rem;
      white-space: nowrap;
    }

    marquee {
      color: white;
      font-size: 0.75rem;
      width: 100px;
      margin: 0 0.5rem;
    }

    button {
      color: white;
      background: none;
      border: none;
      cursor: pointer;
      font-size: 1rem;
    }
  </style>
</head>
<body>
  <div id="bg-grid"></div>

  <div class="flex h-[calc(100vh-100px)] items-center justify-center gap-8 p-4">
    <!-- Kalkulator -->
    <div class="w-[30%] flex flex-col gap-4">
      <div id="display" class="input-bar text-green-400 text-2xl">0</div>

      <div class="grid grid-cols-5 gap-2">
        <button class="btn">7</button><button class="btn">8</button><button class="btn">9</button><button class="btn">/</button><button class="btn">√</button>
        <button class="btn">4</button><button class="btn">5</button><button class="btn">6</button><button class="btn">*</button><button class="btn">^</button>
        <button class="btn">1</button><button class="btn">2</button><button class="btn">3</button><button class="btn">-</button><button class="btn">%</button>
        <button class="btn">0</button><button class="btn">.</button><button class="btn">C</button><button class="btn">=</button><button class="btn">+</button>
      </div>

      <input id="functionInput" class="input-bar" placeholder="enter function" />
    </div>

    <!-- Canvas -->
    <div class="w-[30%] aspect-square">
      <canvas id="graphCanvas" class="w-full h-full bg-black"></canvas>
    </div>
  </div>

  <!-- Audio Player -->
  <div class="audio-bar">
    <button onclick="toggleMute()">mute</button>
    <marquee id="trackTitle">Loading track...</marquee>
    <button onclick="prevTrack()">«</button>
    <button onclick="nextTrack()">»</button>
  </div>

  <!-- YouTube iframe (hidden) -->
  <iframe id="yt-iframe" style="display:none;" allow="autoplay"></iframe>

  <script>
    const display = document.getElementById('display');
    const buttons = document.querySelectorAll('.btn');
    let input = '';

    buttons.forEach(btn => {
      btn.addEventListener('click', () => {
        const val = btn.textContent;
        if (val === 'C') input = '';
        else if (val === '=') {
          try { input = eval(input).toString(); }
          catch { input = 'ERROR'; }
        } else if (val === '√') {
          input = Math.sqrt(parseFloat(input)).toString();
        } else if (val === '^') {
          input += '**';
        } else {
          input += val;
        }
        display.textContent = input || '0';
      });
    });

    // Canvas
    const canvas = document.getElementById('graphCanvas');
    const ctx = canvas.getContext('2d');

    function resizeCanvas() {
      canvas.width = canvas.clientWidth;
      canvas.height = canvas.clientHeight;
    }

    function drawAxes() {
      ctx.strokeStyle = 'white';
      ctx.beginPath();
      ctx.moveTo(0, canvas.height/2);
      ctx.lineTo(canvas.width, canvas.height/2);
      ctx.moveTo(canvas.width/2, 0);
      ctx.lineTo(canvas.width/2, canvas.height);
      ctx.stroke();

      ctx.fillStyle = 'white';
      ctx.font = '12px monospace';
      ctx.fillText('x', canvas.width - 15, canvas.height/2 - 5);
      ctx.fillText('y', canvas.width/2 + 5, 15);
    }

    function drawFunction(funcStr) {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawAxes();

      const colors = ['#ff00ff', '#00ffff', '#ffff00', '#ff8800', '#00ff00'];
      ctx.strokeStyle = colors[Math.floor(Math.random() * colors.length)];
      ctx.beginPath();

      for (let px = 0; px < canvas.width; px++) {
        const x = (px - canvas.width/2);
        let y;
        try {
          y = eval(funcStr.replace(/x/g, `(${x})`));
        } catch {
          return;
        }
        const py = canvas.height/2 - y;
        if (px === 0) ctx.moveTo(px, py);
        else ctx.lineTo(px, py);
      }
      ctx.stroke();
    }

    function renderDefaultMessage() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = 'white';
      ctx.font = '16px monospace';
      ctx.textAlign = 'center';
      ctx.fillText('enter a linear function', canvas.width/2, canvas.height/2);
    }

    functionInput.addEventListener('input', () => {
      const input = functionInput.value.trim();
      if (!input) return renderDefaultMessage();
      const match = input.match(/^y\s*=\s*(.*)/);
      if (match) drawFunction(match[1]);
      else renderDefaultMessage();
    });

    resizeCanvas();
    renderDefaultMessage();
    window.addEventListener('resize', () => {
      resizeCanvas();
      renderDefaultMessage();
    });

    // Audio
    const tracks = [
      { title: 'Retrowave Mix 1', embed: 'https://www.youtube.com/embed/4xDzrJKXOOY?autoplay=1&mute=0' },
      { title: 'Lofi City Night', embed: 'https://www.youtube.com/embed/f02mOEt11OQ?autoplay=1&mute=0' },
      { title: 'Dreamscape Full Mix', embed: 'https://www.youtube.com/embed/GtQdIY3k2C4?autoplay=1&mute=0' },
      { title: 'Neon Nights 45min', embed: 'https://www.youtube.com/embed/cU8HrO7XuiE?autoplay=1&mute=0' }
    ];

    let currentTrack = Math.floor(Math.random() * tracks.length);

    function loadTrack() {
      const iframe = document.getElementById('yt-iframe');
      const title = document.getElementById('trackTitle');
      const track = tracks[currentTrack];
      iframe.src = track.embed;
      title.textContent = track.title;
    }

    function nextTrack() {
      currentTrack = (currentTrack + 1) % tracks.length;
      loadTrack();
    }

    function prevTrack() {
      currentTrack = (currentTrack - 1 + tracks.length) % tracks.length;
      loadTrack();
    }

    function toggleMute() {
      const iframe = document.getElementById('yt-iframe');
      if (iframe.src.includes('mute=1')) {
        iframe.src = iframe.src.replace('mute=1', 'mute=0');
      } else {
        iframe.src = iframe.src.replace('mute=0', 'mute=1');
      }
    }

    loadTrack();
  </script>
</body>
</html>
